<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>CODE BLACK 레이드 공헌도 계산기</title>
  <style>
    :root {
      --bg: #020617;
      --panel: #020617;
      --panel-inner: #020617;
      --border: #1f2937;
      --accent: #173161;
      --accent-hover: #425b8f;
      --accent-green: #16a34a;
      --accent-green-hover: #15803d;
      --danger: #b91c1c;
      --danger-hover: #991b1b;
      --text-main: #e5e7eb;
      --text-sub: #9ca3af;
      --text-strong: #f9fafb;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 20px;
      background: radial-gradient(circle at top, #0b1120 0, #020617 50%, #000 100%);
      font-family: "맑은 고딕", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      display: flex;
      flex-direction: row;
      gap: 20px;
      min-height: 100vh;
    }

    .title-with-icon {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .title-with-icon .title-icon {
      width: 64px;
      height: 64px;
      object-fit: contain;
      opacity: 0.9;
      border-radius: 4px;
    }

    .card {
      background: rgba(15,23,42,0.92);
      border-radius: 12px;
      padding: 16px 18px;
      border: 1px solid #1f2937;
      box-shadow: 0 18px 35px rgba(0,0,0,0.55);
      backdrop-filter: blur(10px);
    }

    .left {
      flex: 3;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .right {
      flex: 2;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    h1 {
      font-size: 20px;
      margin: 0 0 10px 0;
      letter-spacing: 0.05em;
      color: var(--text-strong);
    }

    h2 {
      font-size: 16px;
      margin: 0 0 10px 0;
      color: var(--text-strong);
    }

    label {
      font-size: 13px;
    }

    select,
    input[type="number"] {
      background: #020617;
      color: var(--text-main);
      border: 1px solid #1f2937;
      border-radius: 6px;
      padding: 4px 6px;
      font-size: 13px;
      min-width: 0;
    }

    select:focus,
    input[type="number"]:focus {
      outline: 1px solid #3b82f6;
      border-color: #3b82f6;
    }

    .row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .btn {
      border: none;
      border-radius: 8px;
      padding: 6px 14px;
      font-size: 13px;
      cursor: pointer;
      color: var(--text-strong);
      transition: background 0.15s ease, transform 0.1s ease;
      white-space: nowrap;
    }

    .btn:active {
      transform: translateY(1px);
    }

    .btn-add {
      background: var(--accent);
    }
    .btn-add:hover {
      background: var(--accent-hover);
    }

    .btn-calc {
      background: var(--accent-green);
    }
    .btn-calc:hover {
      background: var(--accent-green-hover);
    }

    .btn-del {
      background: var(--danger);
      padding: 4px 10px;
      font-size: 12px;
    }
    .btn-del:hover {
      background: var(--danger-hover);
    }

    .section-title {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .char-info-grid {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 4px;
      font-size: 13px;
      margin-bottom: 12px;
    }

    #base-label,
    #equip-label {
      white-space: normal;
      line-height: 1.35;
      width: 100%;
    }

    .char-rank-line {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .char-rank-line label {
      white-space: nowrap;
    }

    .char-rank-line select {
      width: 80px;
    }

    .char-info-extra {
      margin-top: 6px;
      font-size: 13px;
      color: var(--text-sub);
    }

    .actions-header {
      display: grid;
      grid-template-columns: 32px 140px 120px 110px 110px 60px;
      gap: 6px;
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 4px;
      color: var(--text-strong);
    }

    .action-row {
      display: grid;
      grid-template-columns: 32px 140px 120px 110px 110px 60px;
      gap: 6px;
      align-items: center;
      margin-bottom: 4px;
      font-size: 13px;
    }

    .action-index {
      text-align: center;
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      margin-top: 4px;
    }

    .checkbox-row input[type="checkbox"] {
      width: 14px;
      height: 14px;
    }

    .bottom-bar {
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: flex-end;
    }

    .bottom-bar-left {
      margin-right: auto;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .total-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .total-number {
      font-size: 28px;
      font-weight: 800;
      letter-spacing: 0.06em;
      margin-bottom: 4px;
      color: #e5e7eb;
    }

    .total-caption {
      font-size: 12px;
      color: var(--text-sub);
      margin-bottom: 16px;
    }

    .info-text {
      font-size: 12px;
      color: var(--text-sub);
      white-space: pre-line;
      line-height: 1.5;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid #1f2937;
      margin-bottom: 10px;
      color: var(--text-sub);
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
    }

    @media (max-width: 960px) {
      body {
        flex-direction: column;
      }
      .left, .right {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="left">
    <!-- 캐릭터 정보 카드 -->
    <div class="card">
      <div class="title-with-icon">
        <img src="icon.png" class="title-icon" alt="icon" />
        <strong>CODE BLACK 레이드 공헌도 계산기</strong>
      </div>
      <div class="char-info-grid">
        <div class="char-rank-line">
          <label for="char-rank">노번트 등급:</label>
          <select id="char-rank">
            <option value="C">C</option>
            <option value="B">B</option>
            <option value="A">A</option>
            <option value="S">S</option>
            <option value="SS">SS</option>
          </select>
        </div>
      
        <div id="base-label">
          기본 공헌도: C = 50
        </div>
        <div id="equip-label">
          장비 공헌도: C = 5000
        </div>
      </div>
      
      <div class="char-info-extra">
        캐릭터 등급을 선택하면 기본 공헌도와 장비 공헌도가 자동으로 반영됩니다.
      </div>
    </div>

    <!-- 행동 목록 카드 -->
    <div class="card">
      <div class="section-title">행동 목록</div>
      <div class="actions-header">
        <div>#</div>
        <div>행동 종류</div>
        <div>페어 등급</div>
        <div>스킬 위력</div>
        <div>지원 인원수</div>
        <div>삭제</div>
      </div>
      <div id="actions-container">
        <!-- 행동 줄들이 JS로 들어옴 -->
      </div>

      <div class="bottom-bar">
        <div class="bottom-bar-left">
          <label class="checkbox-row">
            <input type="checkbox" id="equip-include" />
            <span>장비 공헌도 포함</span>
          </label>
        </div>
        <button id="add-action-btn" class="btn btn-add">+ 행동 추가</button>
        <button id="calc-btn" class="btn btn-calc">최종 공헌도 계산</button>
      </div>
    </div>
  </div>

  <!-- 오른쪽 결과 카드 -->
  <div class="right">
    <div class="card">
      <div class="total-title">최종 공헌도</div>
      <div id="total-display" class="total-number">0</div>
      <div class="total-caption">(장비 포함 여부는 왼쪽 체크박스로 조절)</div>
      <div class="pill">
        <span class="pill-dot"></span>
        <span>모든 값은 내부적으로 동일 공식으로 계산됩니다.</span>
      </div>
      <div class="info-text">
• 개인 스킬: 기본 공헌도 × 스킬 위력
• 지원: ((기본 공헌도 × 1.5) × 인원수) × 스킬 위력
• 레조넌스/광폭화: (내 공헌도 + 페어 공헌도) × 200

※ 행동을 비워두면 무시되고,
   장비 공헌도만 체크해도 계산됩니다.
      </div>
    </div>
  </div>

  <script>
    // ==== 파이썬 코드에 맞춘 상수들 ====
    const RANK_BASE = {
      "C": 50,
      "B": 60,
      "A": 100,
      "S": 200,
      "SS": 300,
    };

    const EQUIP_BASE = {
      "C": 5000,
      "B": 6000,
      "A": 10000,
      "S": 20000,
      "SS": 30000,
    };

    const ACTION_TYPES = ["선택해주세요", "개인 스킬", "지원", "레조넌스/광폭화"];
    const RANKS = ["SS", "S", "A", "B", "C"];

    const charRankSelect = document.getElementById("char-rank");
    const baseLabel = document.getElementById("base-label");
    const equipLabel = document.getElementById("equip-label");
    const actionsContainer = document.getElementById("actions-container");
    const equipIncludeCheckbox = document.getElementById("equip-include");
    const totalDisplay = document.getElementById("total-display");
    const addActionBtn = document.getElementById("add-action-btn");
    const calcBtn = document.getElementById("calc-btn");

    // ==== 캐릭터 등급 정보 업데이트 ====
    function updateRankInfo() {
      const rank = charRankSelect.value;
      const base = RANK_BASE[rank] ?? 0;
      const equip = EQUIP_BASE[rank] ?? 0;
      baseLabel.textContent = `기본 공헌도: ${rank} = ${base}`;
      equipLabel.textContent = `장비 공헌도: ${rank} = ${equip}`;
    }

    charRankSelect.addEventListener("change", updateRankInfo);

    // ==== 행동 줄 관련 ====
    function createActionRow(index) {
      const row = document.createElement("div");
      row.className = "action-row";

      // 번호
      const idxSpan = document.createElement("div");
      idxSpan.className = "action-index";
      idxSpan.textContent = index;
      row.appendChild(idxSpan);

      // 행동 종류 select
      const typeSelect = document.createElement("select");
      typeSelect.className = "action-type";
      for (const t of ACTION_TYPES) {
        const opt = document.createElement("option");
        opt.value = t;
        opt.textContent = t;
        typeSelect.appendChild(opt);
      }
      typeSelect.value = "선택해주세요";
      row.appendChild(typeSelect);

      // 페어 등급 select
      const pairSelect = document.createElement("select");
      pairSelect.className = "pair-rank";
      for (const r of RANKS) {
        const opt = document.createElement("option");
        opt.value = r;
        opt.textContent = r;
        pairSelect.appendChild(opt);
      }
      pairSelect.value = "C";
      row.appendChild(pairSelect);

      // 스킬 위력
      const skillInput = document.createElement("input");
      skillInput.type = "number";
      skillInput.className = "skill-input";
      skillInput.min = "0";
      skillInput.step = "0.1";
      row.appendChild(skillInput);

      // 지원 인원수
      const peopleInput = document.createElement("input");
      peopleInput.type = "number";
      peopleInput.className = "people-input";
      peopleInput.min = "0";
      peopleInput.step = "1";
      row.appendChild(peopleInput);

      // 삭제 버튼 (첫 줄은 없음)
      let delBtn = null;
      if (index > 1) {
        delBtn = document.createElement("button");
        delBtn.type = "button";
        delBtn.textContent = "삭제";
        delBtn.className = "btn btn-del";
        delBtn.addEventListener("click", () => {
          row.remove();
          renumberRows();
        });
        row.appendChild(delBtn);
      } else {
        const emptyCell = document.createElement("div");
        row.appendChild(emptyCell);
      }

      // 행동 종류 변경 시 표시/숨김
      function updateVisibility(choice) {
        // 기본값: 다 숨기기 (자리만 유지)
        pairSelect.style.visibility   = "hidden";
        skillInput.style.visibility   = "hidden";
        peopleInput.style.visibility  = "hidden";

        if (choice === "개인 스킬") {
          // 스킬 위력만 보이기
          skillInput.style.visibility = "visible";
        } else if (choice === "지원") {
          // 스킬 + 인원수 보이기
          skillInput.style.visibility  = "visible";
          peopleInput.style.visibility = "visible";
        } else if (choice === "레조넌스/광폭화") {
          // 페어 등급만 보이기
          pairSelect.style.visibility = "visible";
        }
      }

      typeSelect.addEventListener("change", (e) => {
        updateVisibility(e.target.value);
      });

      // 초기 상태: 선택해주세요 → 전부 숨김
      updateVisibility(typeSelect.value);

      return row;
    }

    function renumberRows() {
      const rows = actionsContainer.querySelectorAll(".action-row");
      rows.forEach((row, idx) => {
        const indexCell = row.querySelector(".action-index");
        if (indexCell) indexCell.textContent = idx + 1;
        const delBtn = row.querySelector(".btn-del");
        if (idx === 0) {
          if (delBtn) {
            delBtn.remove();
            const emptyCell = document.createElement("div");
            row.appendChild(emptyCell);
          }
        }
      });
    }

    addActionBtn.addEventListener("click", () => {
      const currentCount = actionsContainer.querySelectorAll(".action-row").length;
      const newRow = createActionRow(currentCount + 1);
      actionsContainer.appendChild(newRow);
    });

    // ==== 공헌도 계산산 ====
    function calculateActionContribution(base, type, skillText, peopleText, pairRank) {
      let skill = 0.0;
      let people = 0.0;

      if (type === "개인 스킬" || type === "지원") {
        if (!skillText) {
          throw new Error("스킬 위력을 입력하세요.");
        }
        skill = Number(skillText);
        if (Number.isNaN(skill)) {
          throw new Error("스킬 위력은 숫자로 입력하세요.");
        }
      }

      if (type === "지원") {
        if (!peopleText) {
          throw new Error("지원 행동의 인원수를 입력하세요. (최대 2명)");
        }
        people = Number(peopleText);
        if (Number.isNaN(people)) {
          throw new Error("인원수는 숫자로 입력하세요.");
        }
      }

      if (type === "개인 스킬") {
        return base * skill;
      }

      if (type === "지원") {
        return ((base * 1.5) * people) * skill;
      }

      if (type === "레조넌스/광폭화") {
        if (!RANK_BASE.hasOwnProperty(pairRank)) {
          throw new Error("페어 등급을 선택하세요.");
        }
        const pairBase = RANK_BASE[pairRank];
        return (base + pairBase) * 200;
      }

      return 0;
    }

    function calculateTotal() {
      try {
        const rank = charRankSelect.value;
        if (!RANK_BASE.hasOwnProperty(rank)) {
          alert("노번트 등급을 먼저 선택하세요.");
          return;
        }
        const base = RANK_BASE[rank];
        let total = 0;

        const rows = actionsContainer.querySelectorAll(".action-row");
        rows.forEach((row) => {
          const type = row.querySelector(".action-type").value;
          const skillText = row.querySelector(".skill-input").value.trim();
          const peopleText = row.querySelector(".people-input").value.trim();
          const pairRank = row.querySelector(".pair-rank").value;

          // 완전히 빈 줄은 무시
          if (type === "개인 스킬" && skillText === "") return;
          if (type === "지원" && skillText === "" && peopleText === "") return;
          if (type === "선택해주세요") return;

          const contrib = calculateActionContribution(base, type, skillText, peopleText, pairRank);
          total += contrib;
        });

        if (equipIncludeCheckbox.checked) {
          const equip = EQUIP_BASE[rank] ?? 0;
          total += equip;
        }

        totalDisplay.textContent = Math.floor(total).toLocaleString("ko-KR");
      } catch (err) {
        alert("입력 오류: " + err.message);
      }
    }

    calcBtn.addEventListener("click", calculateTotal);

    // 초기 1줄 생성 + 등급 표시 초기화
    (function init() {
      const firstRow = createActionRow(1);
      actionsContainer.appendChild(firstRow);
      updateRankInfo();
    })();
  </script>
</body>
</html>
